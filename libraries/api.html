

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>API Library &mdash; LavaLust 4.3.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d75fae25" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=7736b493" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=a17b270f"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cache Class" href="cache.html" />
    <link rel="prev" title="Libraries" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            LavaLust
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../general/index.html">Welcome to LavaLust</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">LavaLust Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core_topics/index.html">General Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database/index.html">Database Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Libraries</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">API Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#folder-structure">Folder Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#properties">Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#methods">Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#database-structure">Database Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#controller-example">Controller Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-postman-with-php-api-controller">Using Postman with PHP API Controller</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#login">Login</a></li>
<li class="toctree-l4"><a class="reference internal" href="#logout">Logout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#list-users">List Users</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-user">Create User</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-user">Update User</a></li>
<li class="toctree-l4"><a class="reference internal" href="#delete-user">Delete User</a></li>
<li class="toctree-l4"><a class="reference internal" href="#profile">Profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#refresh-token">Refresh Token</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tips">Tips</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cache.html">Cache Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Config Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="email.html">Email Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="encryption.html">Encryption Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="upload.html">Upload Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="form_validation.html">Form Validation Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html">Input and Output Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="language.html">Language Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration.html">Migration Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="pagination.html">Pagination Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Security Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="session.html">Session Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_security.html">Session Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">Performance Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="ember.html">Ember Template Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="ember.html#module-Ember_registrar">Ember Registrar</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../helpers/index.html">Helpers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LavaLust</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Libraries</a></li>
      <li class="breadcrumb-item active">API Library</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="api-library">
<h1>API Library<a class="headerlink" href="#api-library" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">Api</span></code> library provides helper methods for building secure RESTful APIs in LavaLust.
It supports:</p>
<ul class="simple">
<li><p>CORS headers</p></li>
<li><p>Parsing JSON/form bodies</p></li>
<li><p>Standard API responses</p></li>
<li><p>JWT-based authentication (access/refresh token system)</p></li>
<li><p>Basic authentication</p></li>
<li><p>Refresh token encryption and storage</p></li>
</ul>
<p>This library is automatically configured using values from <code class="docutils literal notranslate"><span class="pre">app/config/api.php</span></code>.</p>
<section id="folder-structure">
<h2>Folder Structure<a class="headerlink" href="#folder-structure" title="Link to this heading"></a></h2>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>app/
├── controllers/
│   └── ApiController.php
│
└── config/
    └── api.php
</pre></div>
</div>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<p>Set the following values in <code class="docutils literal notranslate"><span class="pre">app/config/api.php</span></code>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;api_helper_enabled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>
<span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;payload_token_expiration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">900</span><span class="p">;</span>
<span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;refresh_token_expiration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">604800</span><span class="p">;</span>
<span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;jwt_secret&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;l99H8TM4Q4JXFM3Hr8LN&#39;</span><span class="p">;</span>
<span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;refresh_token_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BDswlrEaYWAgeJ4VurGe&#39;</span><span class="p">;</span>
<span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;allow_origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">;</span>
<span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;refresh_token_table&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;refresh_tokens&#39;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="properties">
<h2>Properties<a class="headerlink" href="#properties" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">$_lava</span></code></p></td>
<td><p>object</p></td>
<td><p>LavaLust super object (via <code class="docutils literal notranslate"><span class="pre">lava_instance()</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">$refresh_token_table</span></code></p></td>
<td><p>string</p></td>
<td><p>Database table name for storing refresh tokens</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">$payload_token_expiration</span></code></p></td>
<td><p>integer</p></td>
<td><p>Lifetime of access (payload) tokens in seconds</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">$refresh_token_expiration</span></code></p></td>
<td><p>integer</p></td>
<td><p>Lifetime of refresh tokens in seconds</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">$allow_origin</span></code></p></td>
<td><p>string</p></td>
<td><p>Allowed origin for CORS</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">$jwt_secret</span></code></p></td>
<td><p>string</p></td>
<td><p>Secret key used for signing JWT tokens</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">$refresh_token_key</span></code></p></td>
<td><p>string</p></td>
<td><p>Key used for encrypting refresh tokens</p></td>
</tr>
</tbody>
</table>
</section>
<section id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Link to this heading"></a></h2>
<p><strong>CORS &amp; Request Helpers</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">handle_cors()</span></code></p></td>
<td><p>Sets CORS headers. Called automatically in the constructor.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">body():</span> <span class="pre">array</span></code></p></td>
<td><p>Parses JSON or form-encoded request body and returns it as an array.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">get_query_params():</span> <span class="pre">array</span></code></p></td>
<td><p>Returns URL query parameters as an associative array.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">require_method(string</span> <span class="pre">$method)</span></code></p></td>
<td><p>Enforces a specific HTTP method. Sends 405 if not matched.</p></td>
</tr>
</tbody>
</table>
<p><strong>Responses</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">respond(mixed</span> <span class="pre">$data,</span> <span class="pre">int</span> <span class="pre">$code</span> <span class="pre">=</span> <span class="pre">200)</span></code></p></td>
<td><p>Sends a JSON response with HTTP status code.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">respond_error(string</span> <span class="pre">$message,</span> <span class="pre">int</span> <span class="pre">$code</span> <span class="pre">=</span> <span class="pre">400)</span></code></p></td>
<td><p>Sends an error response with a message and status code.</p></td>
</tr>
</tbody>
</table>
<p><strong>JWT Authentication</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">encode_jwt(array</span> <span class="pre">$payload):</span> <span class="pre">string</span></code></p></td>
<td><p>Encodes data into a signed JWT.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">decode_jwt(string</span> <span class="pre">$token):</span> <span class="pre">array|false</span></code></p></td>
<td><p>Decodes and verifies a JWT.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">validate_jwt(string</span> <span class="pre">$token):</span> <span class="pre">array|false</span></code></p></td>
<td><p>Validates structure and expiration of a JWT.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">get_bearer_token():</span> <span class="pre">?string</span></code></p></td>
<td><p>Extracts a JWT bearer token from the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">require_jwt():</span> <span class="pre">array</span></code></p></td>
<td><p>Validates the current bearer token and returns its payload.</p></td>
</tr>
</tbody>
</table>
<p><strong>Token System</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">issue_tokens(array</span> <span class="pre">$user_data):</span> <span class="pre">array</span></code></p></td>
<td><p>Issues an access token and a refresh token, stores the refresh token in the database.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">refresh_access_token(string</span> <span class="pre">$refresh_token)</span></code></p></td>
<td><p>Validates and rotates a refresh token, issues new tokens.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">revoke_refresh_token(string</span> <span class="pre">$refresh_token)</span></code></p></td>
<td><p>Deletes a refresh token from the database.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cleanup_expired_refresh_tokens(int</span> <span class="pre">$user_id)</span></code></p></td>
<td><p>Deletes expired refresh tokens for a user.</p></td>
</tr>
</tbody>
</table>
<p><strong>Basic Authentication</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">check_basic_auth(string</span> <span class="pre">$user,</span> <span class="pre">string</span> <span class="pre">$pass):</span> <span class="pre">bool</span></code></p></td>
<td><p>Verifies provided basic auth credentials.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">require_basic_auth(string</span> <span class="pre">$user,</span> <span class="pre">string</span> <span class="pre">$pass)</span></code></p></td>
<td><p>Requires valid basic auth, otherwise sends a 401 Unauthorized response.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="database-structure">
<h2>Database Structure<a class="headerlink" href="#database-structure" title="Link to this heading"></a></h2>
<p><strong>Table: ``users``</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Null</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>INT(11) PK AI</p></td>
<td><p>NO</p></td>
<td><p>AUTO_INCREMENT</p></td>
<td><p>Primary key</p></td>
</tr>
<tr class="row-odd"><td><p>username</p></td>
<td><p>VARCHAR(50) UNIQUE</p></td>
<td><p>NO</p></td>
<td><p>—</p></td>
<td><p>Username of the user</p></td>
</tr>
<tr class="row-even"><td><p>email</p></td>
<td><p>VARCHAR(100) UNIQUE</p></td>
<td><p>NO</p></td>
<td><p>—</p></td>
<td><p>Email address of the user</p></td>
</tr>
<tr class="row-odd"><td><p>password</p></td>
<td><p>VARCHAR(255)</p></td>
<td><p>NO</p></td>
<td><p>—</p></td>
<td><p>Hashed password</p></td>
</tr>
<tr class="row-even"><td><p>role</p></td>
<td><p>VARCHAR(20)</p></td>
<td><p>YES</p></td>
<td><p>‘user’</p></td>
<td><p>User role (default: user)</p></td>
</tr>
<tr class="row-odd"><td><p>created_at</p></td>
<td><p>TIMESTAMP</p></td>
<td><p>YES</p></td>
<td><p>CURRENT_TIMESTAMP</p></td>
<td><p>Record creation time</p></td>
</tr>
</tbody>
</table>
<p><strong>Table: ``refresh_tokens``</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>INT PK AI</p></td>
<td><p>Primary key</p></td>
</tr>
<tr class="row-odd"><td><p>user_id</p></td>
<td><p>INT</p></td>
<td><p>Associated user ID</p></td>
</tr>
<tr class="row-even"><td><p>token</p></td>
<td><p>TEXT</p></td>
<td><p>Encrypted refresh token</p></td>
</tr>
<tr class="row-odd"><td><p>expires_at</p></td>
<td><p>DATETIME</p></td>
<td><p>Expiration date of the refresh token</p></td>
</tr>
</tbody>
</table>
</section>
<section id="controller-example">
<h2>Controller Example<a class="headerlink" href="#controller-example" title="Link to this heading"></a></h2>
<p><strong>Routes</strong></p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">$router-&gt;post(&#39;login&#39;, &#39;ApiController::login&#39;);</span>
<span class="x">$router-&gt;post(&#39;logout&#39;, &#39;ApiController::logout&#39;);</span>
<span class="x">$router-&gt;post(&#39;create&#39;, &#39;ApiController::create&#39;);</span>
<span class="x">$router-&gt;put(&#39;update/{id}&#39;, &#39;ApiController::update&#39;);</span>
<span class="x">$router-&gt;delete(&#39;delete/{id}&#39;, &#39;ApiController::delete&#39;);</span>
<span class="x">$router-&gt;get(&#39;list&#39;, &#39;ApiController::list&#39;);</span>
<span class="x">$router-&gt;get(&#39;profile&#39;, &#39;ApiController::profile&#39;);</span>
<span class="x">$router-&gt;post(&#39;refresh&#39;, &#39;ApiController::refresh&#39;);</span>
</pre></div>
</div>
<p><strong>Controller</strong></p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">ApiController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$user_id</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">require_method</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">);</span>
        <span class="nv">$input</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">body</span><span class="p">();</span>
        <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$password</span> <span class="o">=</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

        <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">raw</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM users WHERE username = ?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$username</span><span class="p">]);</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$user</span> <span class="o">&amp;&amp;</span> <span class="nb">password_verify</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$tokens</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">issue_tokens</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]]);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">respond</span><span class="p">(</span><span class="nv">$tokens</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">respond_error</span><span class="p">(</span><span class="s1">&#39;Invalid credentials&#39;</span><span class="p">,</span> <span class="mi">401</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">require_method</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">);</span>
        <span class="nv">$input</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">body</span><span class="p">();</span>
        <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">revoke_refresh_token</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">respond</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Logged out&#39;</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">list</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                         <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;id, username, email, role, created_at&#39;</span><span class="p">)</span>
                         <span class="o">-&gt;</span><span class="na">get_all</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">respond</span><span class="p">(</span><span class="nv">$stmt</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$input</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">body</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">raw</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO users (username, email, password, role, created_at)</span>
<span class="s2">             VALUES (?, ?, ?, ?, NOW())&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span> <span class="nb">password_hash</span><span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span> <span class="nx">PASSWORD_BCRYPT</span><span class="p">),</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]]</span>
        <span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">respond</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;User created&#39;</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$input</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">body</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">raw</span><span class="p">(</span><span class="s2">&quot;UPDATE users SET username=?, email=?, role=? WHERE id=?&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">],</span> <span class="nv">$id</span><span class="p">]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">respond</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;User updated&#39;</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">raw</span><span class="p">(</span><span class="s2">&quot;DELETE FROM users WHERE id = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$id</span><span class="p">]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">respond</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;User deleted&#39;</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">profile</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$auth</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">require_jwt</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user_id</span> <span class="o">=</span> <span class="nv">$auth</span><span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">];</span>
        <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">raw</span><span class="p">(</span>
            <span class="s2">&quot;SELECT id, username, email, role, created_at FROM users WHERE id = ?&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">]</span>
        <span class="p">);</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">respond</span><span class="p">(</span><span class="nv">$user</span> <span class="o">?:</span> <span class="p">[</span><span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;User not found&#39;</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">refresh</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">require_method</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">);</span>
        <span class="nv">$input</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">body</span><span class="p">();</span>
        <span class="nv">$refresh_token</span> <span class="o">=</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">api</span><span class="o">-&gt;</span><span class="na">refresh_access_token</span><span class="p">(</span><span class="nv">$refresh_token</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="using-postman-with-php-api-controller">
<h2>Using Postman with PHP API Controller<a class="headerlink" href="#using-postman-with-php-api-controller" title="Link to this heading"></a></h2>
<p>This guide shows how to test each endpoint of your PHP API using <strong>Postman</strong>, either in VS Code (via Postman extension) or the standalone Postman app.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use your actual base URL (e.g. <code class="docutils literal notranslate"><span class="pre">http://localhost/ApiController/...</span></code>) when testing.</p>
</div>
<section id="login">
<h3>Login<a class="headerlink" href="#login" title="Link to this heading"></a></h3>
<p><strong>Endpoint:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>POST /ApiController/login
</pre></div>
</div>
<p><strong>Request Body:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
  &quot;username&quot;: &quot;admin&quot;,
  &quot;password&quot;: &quot;your_password&quot;
}
</pre></div>
</div>
<p><strong>Expected Response:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
  &quot;access_token&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6...&quot;,
  &quot;refresh_token&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6...&quot;
}
</pre></div>
</div>
</section>
<section id="logout">
<h3>Logout<a class="headerlink" href="#logout" title="Link to this heading"></a></h3>
<p><strong>Endpoint:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>POST /ApiController/logout
</pre></div>
</div>
<p><strong>Request Body:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
  &quot;refresh_token&quot;: &quot;your_refresh_token&quot;
}
</pre></div>
</div>
<p><strong>Expected Response:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
  &quot;message&quot;: &quot;Logged out&quot;
}
</pre></div>
</div>
</section>
<section id="list-users">
<h3>List Users<a class="headerlink" href="#list-users" title="Link to this heading"></a></h3>
<p><strong>Endpoint:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GET /ApiController/list
</pre></div>
</div>
<p><strong>Headers:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Authorization: Bearer your_access_token
</pre></div>
</div>
<p><strong>Expected Response:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[
  {
    &quot;id&quot;: 1,
    &quot;username&quot;: &quot;admin&quot;,
    &quot;email&quot;: &quot;admin@example.com&quot;,
    &quot;role&quot;: &quot;admin&quot;,
    &quot;created_at&quot;: &quot;2025-08-01 12:00:00&quot;
  },
  ...
]
</pre></div>
</div>
</section>
<section id="create-user">
<h3>Create User<a class="headerlink" href="#create-user" title="Link to this heading"></a></h3>
<p><strong>Endpoint:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>POST /ApiController/create
</pre></div>
</div>
<p><strong>Headers:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Authorization: Bearer your_access_token
Content-Type: application/json
</pre></div>
</div>
<p><strong>Request Body:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
  &quot;username&quot;: &quot;newuser&quot;,
  &quot;email&quot;: &quot;newuser@example.com&quot;,
  &quot;password&quot;: &quot;secure123&quot;,
  &quot;role&quot;: &quot;user&quot;
}
</pre></div>
</div>
</section>
<section id="update-user">
<h3>Update User<a class="headerlink" href="#update-user" title="Link to this heading"></a></h3>
<p><strong>Endpoint:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>PUT /ApiController/update/{id}
</pre></div>
</div>
<p><strong>Headers:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Authorization: Bearer your_access_token
Content-Type: application/json
</pre></div>
</div>
<p><strong>Request Body:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
  &quot;username&quot;: &quot;updateduser&quot;,
  &quot;email&quot;: &quot;updated@example.com&quot;,
  &quot;role&quot;: &quot;editor&quot;
}
</pre></div>
</div>
</section>
<section id="delete-user">
<h3>Delete User<a class="headerlink" href="#delete-user" title="Link to this heading"></a></h3>
<p><strong>Endpoint:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>DELETE /ApiController/delete/{id}
</pre></div>
</div>
<p><strong>Headers:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Authorization: Bearer your_access_token
</pre></div>
</div>
</section>
<section id="profile">
<h3>Profile<a class="headerlink" href="#profile" title="Link to this heading"></a></h3>
<p><strong>Endpoint:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GET /ApiController/profile
</pre></div>
</div>
<p><strong>Headers:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Authorization: Bearer your_access_token
</pre></div>
</div>
</section>
<section id="refresh-token">
<h3>Refresh Token<a class="headerlink" href="#refresh-token" title="Link to this heading"></a></h3>
<p><strong>Endpoint:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>POST /ApiController/refresh
</pre></div>
</div>
<p><strong>Request Body:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
  &quot;refresh_token&quot;: &quot;your_refresh_token&quot;
}
</pre></div>
</div>
</section>
</section>
<section id="tips">
<h2>Tips<a class="headerlink" href="#tips" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Use <strong>Postman collections</strong> to save all these endpoints.</p></li>
<li><p>Use <strong>environment variables</strong> for <code class="docutils literal notranslate"><span class="pre">{{base_url}}</span></code>, <code class="docutils literal notranslate"><span class="pre">{{access_token}}</span></code>, and <code class="docutils literal notranslate"><span class="pre">{{refresh_token}}</span></code> to streamline testing and token management.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notes
- Configure values such as <code class="docutils literal notranslate"><span class="pre">jwt_secret</span></code>, <code class="docutils literal notranslate"><span class="pre">refresh_token_key</span></code>, and expiration times in <code class="docutils literal notranslate"><span class="pre">app/config/api.php</span></code>.
- CORS is automatically handled on every request.
- <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> requests are automatically responded with <code class="docutils literal notranslate"><span class="pre">200</span></code> and exit.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Api</span></code> library simplifies authentication, token management, and secure API development in LavaLust.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Libraries" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cache.html" class="btn btn-neutral float-right" title="Cache Class" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, LavaLust PHP Framework.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>